<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>A (kind-of) Dependency Injection in Scala - Aston&#39;s Programming Thoughts</title>
  <meta name="description" content="The problem While projects evolve, the lines of code increase and the dependencies between the classes are becoming more and more complicated. With the absence of some Dependency Injection (DI) framework/library, this ends up quickly in having to pass instances here and there through constructors of classes. The constructors may end up having something like 10&#43; arguments. To make things worse, for some cases, these arguments are not used by the logic of the classes themselves, but instead, they are just used to create subclasses!">
  <meta name="author" content="Aston"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Aston\u0027s Programming Thoughts",
    
    "url": "https:\/\/astonbitecode.github.io\/blog"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/astonbitecode.github.io\/blog"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/astonbitecode.github.io\/blog",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/astonbitecode.github.io\/blog\/post\/kindofdi\/",
          "name": "A (kind of) dependency injection in scala"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Aston"
  },
  "headline": "A (kind-of) Dependency Injection in Scala",
  "description" : "The problem While projects evolve, the lines of code increase and the dependencies between the classes are becoming more and more complicated. With the absence of some Dependency Injection (DI) framework\/library, this ends up quickly in having to pass instances here and there through constructors of classes. The constructors may end up having something like 10\u002b arguments. To make things worse, for some cases, these arguments are not used by the logic of the classes themselves, but instead, they are just used to create subclasses!",
  "inLanguage" : "en",
  "wordCount":  1339 ,
  "datePublished" : "2015-04-25T08:05:58",
  "dateModified" : "2015-04-25T08:05:58",
  "image" : "https:\/\/astonbitecode.github.io\/blog\/images\/bitten-cake-64.png",
  "keywords" : [ "scala, dependency injection" ],
  "mainEntityOfPage" : "https:\/\/astonbitecode.github.io\/blog\/post\/kindofdi\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/astonbitecode.github.io\/blog",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/astonbitecode.github.io\/blog\/images\/bitten-cake-64.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="A (kind-of) Dependency Injection in Scala" />
<meta property="og:description" content="The problem While projects evolve, the lines of code increase and the dependencies between the classes are becoming more and more complicated. With the absence of some Dependency Injection (DI) framework/library, this ends up quickly in having to pass instances here and there through constructors of classes. The constructors may end up having something like 10&#43; arguments. To make things worse, for some cases, these arguments are not used by the logic of the classes themselves, but instead, they are just used to create subclasses!">
<meta property="og:image" content="https://astonbitecode.github.io/blog/images/bitten-cake-64.png" />
<meta property="og:url" content="https://astonbitecode.github.io/blog/post/kindofdi/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Aston&#39;s Programming Thoughts" />

  <meta name="twitter:title" content="A (kind-of) Dependency Injection in Scala" />
  <meta name="twitter:description" content="The problem While projects evolve, the lines of code increase and the dependencies between the classes are becoming more and more complicated. With the absence of some Dependency Injection (DI) …">
  <meta name="twitter:image" content="https://astonbitecode.github.io/blog/images/bitten-cake-64.png" />
  <meta name="twitter:card" content="summary" />
  <link href='https://astonbitecode.github.io/blog/images/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.74.3" />
  <link rel="alternate" href="https://astonbitecode.github.io/blog/index.xml" type="application/rss+xml" title="Aston&#39;s Programming Thoughts"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://astonbitecode.github.io/blog/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://astonbitecode.github.io/blog/css/syntax.css" /><link rel="stylesheet" href="https://astonbitecode.github.io/blog/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	if (window.sessionStorage) {
		var GA_SESSION_STORAGE_KEY = 'ga:clientId';
		ga('create', 'UA-84657729-1', {
	    'storage': 'none',
	    'clientId': sessionStorage.getItem(GA_SESSION_STORAGE_KEY)
	   });
	   ga(function(tracker) {
	    sessionStorage.setItem(GA_SESSION_STORAGE_KEY, tracker.get('clientId'));
	   });
   }
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://astonbitecode.github.io/blog">Aston&#39;s Programming Thoughts</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/blog">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/blog/page/about/">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Aston&#39;s Programming Thoughts" href="https://astonbitecode.github.io/blog">
            <img class="avatar-img" src="https://astonbitecode.github.io/blog/images/bitten-cake-64.png" alt="Aston&#39;s Programming Thoughts" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>A (kind-of) Dependency Injection in Scala</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on April 25, 2015
  
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Aston
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h1 id="the-problem">The problem</h1>
<p>While projects evolve, the lines of code increase and the dependencies between the classes are becoming more and more complicated. With the absence of some Dependency Injection (DI) framework/library, this ends up quickly in having to pass instances here and there through constructors of classes. The constructors may end up having something like 10+ arguments. To make things worse, for some cases, these arguments are not used by the logic of the classes themselves, but instead, they are just used to create subclasses!</p>
<p>This situation is especially common for projects that are built using a service-oriented architecture internally and of course, makes things tight and difficult during Unit Testing.</p>
<p>Dependency Injection may help keeping the code (mostly) clean and can facilitate the implementation of Unit Tests. However, it is not the choice for everyone and some teams may have decided not to use any DI framework.</p>
<h1 id="the-thought-for-a-way-out">The thought for a way out</h1>
<p>Scala is a very expressive language and it is pretty amazing how beautiful things someone can achieve when using it. We can see this everywhere: in blogs, SO and gists to name a few. So, maybe we could find some delicate and easy way to keep the code cleaner, even without the use of any specific DI libraries.</p>
<h1 id="a-kind-of-di">A kind of DI</h1>
<p>As Jonas Bonér (founder and CTO of Typesafe) says in his blog: “Scala is a very rich and deep language that gives you several ways of doing DI solely based on language constructs”.</p>
<p>In the same blog, he describes a way to perform DI using the Cake Pattern. Searching around the blogs and answers/proposals, one may find out that indeed, DI in Scala can be achieved with several ways.</p>
<p>What we will try to do here, is a kind of DI using Scala-only constructs, in order to be able to create some class instance once and “inject” it wherever is needed.</p>
<h1 id="use-case-to-drive-the-solution">Use case to drive the solution</h1>
<p>Let’s say that we have a class that represents a Configuration Service. This service provides a file path to its users. The service should be used by any class in our application that needs it and it may look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">ConfigurationService</span><span class="o">(</span><span class="n">filePath</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">getFilePath</span><span class="o">()</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">filePath</span>
<span class="o">}</span></code></pre></div>
<h1 id="who-will-instantiate-the-service">Who will instantiate the service?</h1>
<p>In a real DI framework, the container/framework itself should instantiate the ConfigurationService, as being dictated by some XML configuration or annotations, like in Spring.</p>
<p>In this case however, the service will be created by our code, during the startup of the application and before any class asks for it.</p>
<h1 id="a-package-object-in-the-solution">A package object in the solution</h1>
<p>A package object is really helpful because any definition that is done inside the package object is actually member of the package itself. A package object (and a Scala object in general) can provide access to its fields and methods from anywhere in our code.</p>
<p>So, someone could think to create an object like following:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">package</span> <span class="nn">object</span> <span class="n">di</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">configurationService</span><span class="k">:</span> <span class="kt">ConfigurationService</span> <span class="o">=</span> <span class="k">_</span>
<span class="o">}</span></code></pre></div>
<p>However, there are some things that need our attention. Firstly, we need to obey to the functional principle that dictates the use of vals instead of vars.</p>
<p>So, the service should be available to the users immutably, via a val. But how this can be done, since the object will be already created by the time that our application performs the initialization of the service? Well, a small hack including a lazy val and a var could do the trick:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">package</span> <span class="nn">object</span> <span class="n">di</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">configurationServiceVar</span><span class="k">:</span> <span class="kt">ConfigurationService</span> <span class="o">=</span> <span class="k">_</span>
  <span class="k">lazy</span> <span class="k">val</span> <span class="n">configurationService</span><span class="k">:</span> <span class="kt">ConfigurationService</span> <span class="o">=</span> <span class="n">configurationServiceVar</span>
<span class="o">}</span></code></pre></div>
<p>Now the di object offers the ConfigurationService publicly via a val. All we need now is a def that allows the mutation of the var. This mutation should be done early in out Application initialization, before someone asks for the val. If not, the configurationService val will be null during the lifetime of our application.</p>
<p>Let’s try to avoid that by using Options and Exceptions:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">package</span> <span class="nn">object</span> <span class="n">di</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">configurationServiceVar</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">ConfigurationService</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span>
 
  <span class="k">lazy</span> <span class="k">val</span> <span class="n">configurationService</span><span class="k">:</span> <span class="kt">ConfigurationService</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">configurationServiceVar</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="k">throw</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">&#34;Configuration is not yet initialized&#34;</span><span class="o">))</span>
  <span class="o">}</span>
 
  <span class="k">def</span> <span class="n">initService</span><span class="o">(</span><span class="n">cs</span><span class="k">:</span> <span class="kt">ConfigurationService</span><span class="o">)</span> <span class="k">=</span> <span class="n">configurationServiceVar</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="n">cs</span><span class="o">)</span>
<span class="o">}</span></code></pre></div>
<p>With the above code, we are making sure that if someone asks for the ConfigurationService before it gets initialized, he/she will get a nice RuntimeException. Moreover, the RuntimeException will prevent setting the val with something wrong like None.</p>
<p>Our lazy val will stay uninitialized until someone actually initializes it.</p>
<h1 id="making-it-generic">Making it generic</h1>
<p>Until now, the solution handles only the ConfigurationService class. Let’s try to make it more useful, by handling more services generically:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">package</span> <span class="nn">object</span> <span class="n">di</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">readyToInject</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">Class</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">Any</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TrieMap</span><span class="o">.</span><span class="n">empty</span>
 
  <span class="k">private</span> <span class="k">def</span> <span class="n">key</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">implicit</span> <span class="n">classTag</span><span class="k">:</span> <span class="kt">ClassTag</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">classTag</span><span class="o">.</span><span class="n">runtimeClass</span>
 
  <span class="k">def</span> <span class="n">initService</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">ClassTag</span><span class="o">](</span><span class="n">c</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">k</span> <span class="k">=</span> <span class="n">key</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
    <span class="n">readyToInject</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">k</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">initialized</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">&#34;The service already initialized&#34;</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="n">readyToInject</span> <span class="k">=</span> <span class="n">readyToInject</span> <span class="o">+=</span> <span class="o">(</span><span class="n">k</span> <span class="o">-&gt;</span> <span class="n">c</span><span class="o">)</span> 
    <span class="o">}</span>
  <span class="o">}</span>
 
  <span class="k">def</span> <span class="n">inject</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">ClassTag</span><span class="o">]</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">readyToInject</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">key</span><span class="o">[</span><span class="kt">T</span><span class="o">]).</span><span class="n">getOrElse</span><span class="o">(</span><span class="k">throw</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">&#34;The service is not yet initialized&#34;</span><span class="o">)).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>We created a concurrent Map that has a Class as key and Any as value. The potential is that the Map will hold the instances that will be later injected into fields of classes that need them.</p>
<p>We also changed the name of the initService method to inject. This is just to add a bit more “beauty”, as it will make the code easier to understand and to look familiar to us (similarly to @inject annotation).</p>
<h1 id="how-this-kind-of-di-looks-like-to-its-users">How this kind of DI looks like to its users?</h1>
<p>Let’s create a user of the ConfigurationService, a HelpfulClass:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">HelpfulClass</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">val</span> <span class="n">config</span> <span class="k">=</span> <span class="n">inject</span><span class="o">[</span><span class="kt">ConfigurationService</span><span class="o">]</span>
 
  <span class="k">def</span> <span class="n">doSomethingUsingTheConfiguration</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">getFilePath</span><span class="o">())</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>This seems simple and elegant. We expect our config val to have “injected” an instance of the ConfigurationService class, only by issuing:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">private</span> <span class="k">val</span> <span class="n">config</span> <span class="k">=</span> <span class="n">inject</span><span class="o">[</span><span class="kt">ConfigurationService</span><span class="o">]</span></code></pre></div>
<p>Note: For this example and for the sake of simplicity, the ConfigurationService was a concrete class. However, it could also be a trait.</p>
<p>Let’s see what is the result We may test the result by creating a simple Main object and try to see the following:</p>
<ol>
<li>We will try to use the HelpfulClass before the ConfigurationService is created in order to get the resulted exception.</li>
<li>We will initialize and use the ConfigurationService.</li>
<li>We will try to use the HelpfulClass again in order to get the resulted exception.</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">object</span> <span class="nc">Main</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="c1">// Try to use the service before it gets initialized (1)
</span><span class="c1"></span>  <span class="k">try</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">helpfulClassShouldFail</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HelpfulClass</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">error</span><span class="k">:</span> <span class="kt">Exception</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">error</span><span class="o">.</span><span class="n">getMessage</span><span class="o">)</span>
  <span class="o">}</span>
 
  <span class="c1">// Initialize services (like the DI framework would do)
</span><span class="c1"></span>  <span class="n">initService</span><span class="o">(</span><span class="k">new</span> <span class="nc">ConfigurationService</span><span class="o">(</span><span class="s">&#34;/my/path&#34;</span><span class="o">))</span>
 
  <span class="c1">// Run the application (2)
</span><span class="c1"></span>  <span class="k">val</span> <span class="n">helpfulClass</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HelpfulClass</span>
  <span class="n">helpfulClass</span><span class="o">.</span><span class="n">doSomethingUsingTheConfiguration</span>
 
  <span class="c1">// Try to re-initialize the service (3)
</span><span class="c1"></span>  <span class="k">try</span> <span class="o">{</span>
    <span class="n">initService</span><span class="o">(</span><span class="k">new</span> <span class="nc">ConfigurationService</span><span class="o">(</span><span class="s">&#34;/my/other/path&#34;</span><span class="o">))</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">error</span><span class="k">:</span> <span class="kt">Exception</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">error</span><span class="o">.</span><span class="n">getMessage</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>Once this runs, we should see the output:</p>
<p>Configuration is not yet initialized /my/path Configuration is already initialized</p>
<h1 id="drawbacks-and-possible-extensions">Drawbacks and possible extensions</h1>
<p>The main drawback is that it is dangerous to use this kind of DI to inject values into Scala objects. In the case that someone tries to use the object before the ConfiguratioService gets initialized, the application will crash with an ExceptionInInitializerError.</p>
<p>The other thing that doesn’t allow me to call this proper DI, is that the inversion of control is not applied in a proper way. The control of the services creation is still in our own code.</p>
<p>One way to try to abstract away of explicitly creating the instances of services in the code, could be to create logic inside the di package object that would read some XML file and do the instantiation of services using reflection, during the startup of the Application.</p>
<p>Moreover, we could even try to create scopes and, like in Spring for example, support singleton, prototype etc!</p>
<h1 id="what-to-takeaway">What to takeaway?</h1>
<p>The idea, if you like it and the code, of course.
If you are interested, I have created a library that builds on the ideas described here and you can find it on <a href="https://github.com/astonbitecode/kind-of-di">GitHub</a></p>
<p>Thanks for reading!</p>


        
          <div class="blog-tags">
            
              <a href="https://astonbitecode.github.io/blog/tags/scala/">scala</a>&nbsp;
            
              <a href="https://astonbitecode.github.io/blog/tags/dependency-injection/">dependency injection</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://astonbitecode.github.io/blog/post/osgijsf/" data-toggle="tooltip" data-placement="top" title="OSGi: Finding the way to JEE and JSF">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://astonbitecode.github.io/blog/post/foldfor/" data-toggle="tooltip" data-placement="top" title="Scala: Use fold to serialize any number of Futures">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/astonbitecode" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Aston
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2020
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://astonbitecode.github.io/blog">Aston&#39;s Programming Thoughts</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.74.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://astonbitecode.github.io/blog/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://astonbitecode.github.io/blog/js/load-photoswipe.js"></script>









    
  </body>
</html>

